{"pageProps":{"postData":{"id":["2014","01","05","artigo-novidades-do-firebird-25_5"],"contentHtml":"<p>No Firebird, diferentes tabelas ou até mesmo diferentes colunas de uma mesma tabela podem usar diferentes character sets e collates. Isto permite uma grande flexibilidade mas pode causar problemas caso o desenvolvedor ou DBA não se atente às necessidades da aplicação. Por isso, um banco de dados pode ter um character set default, que é automaticamente usado quando não é especificado um character set durante a definição de uma coluna de tipo string. Algo semelhante não existia para collates, sendo que o collate default de cada character set é o modo de comparação binária dos bytes que compõem uma string.<br /><br /> Na nova versão foi introduzido o comando ALTER CHARACTER SET, permitindo a alteração do collate padrão de um character set. Além do comando ALTER CHARACTER SET, agora o collate padrão do character set padrão do banco pode ser definido no momento da criação do banco de dados. A <b>listagem 1</b> mostra a criação de um banco de dados usando o character set padrão WIN1252 e definindo seu collate padrão para WIN_PTBR. Em seguida o collate padrão do character set UTF8 é alterado para UNICODE_CI_AI.<br /><br /><span style=\"vertical-align: baseline;\"></span><br /><b>Listagem 1</b>. Exemplos de alteração de collate padrão.<br /><br /><div><div><span style=\"font-family: Courier New, Courier, monospace;\">CREATE DATABASE 'TEST.FDB'<br />  DEFAULT CHARACTER SET WIN1252<br />  COLLATION WIN_PTBR;<br /><br />ALTER CHARACTER SET UTF8<br />  SET DEFAULT COLLATION UNICODE_CI_AI;</span><br /><br /><span style=\"vertical-align: baseline;\"></span><br />A <b>listagem 2</b> mostra o banco operando com o character set default WIN1252 e o collate WIN_PTBR (case-insensitive).<br /><br /><b>Listagem 2</b>. Comparação de strings usando o collate WIN_PTBR.<br /><br /><span style=\"font-family: Courier New, Courier, monospace;\">CREATE TABLE PESSOAS (NOME VARCHAR(20));<br /><br />INSERT INTO PESSOAS VALUES ('Fulano');<br />INSERT INTO PESSOAS VALUES ('Beltrano');<br /><br />-- Localiza Fulano (= FULANO)<br />SELECT * FROM PESSOAS WHERE NOME = 'FULANO';</span><br /><br /> Outra necessidade comumente encontrada em aplicações é a gravação de códigos alfanuméricos. Até o Firebird 2.1 a ordenação de campos do tipo string era sempre feita no modo de comparação de texto. Isto quer dizer que um código “A10” é listado antes de “A2” caso ordenado por esta coluna. A <b>listagem 3</b> mostra um exemplo desta situação.<br /><br /><b>Listagem 3</b>. Ordenação de códigos alfanuméricos usando o collate UNICODE.<br /><span style=\"font-family: Courier New, Courier, monospace;\"><br /></span></div><span style=\"font-family: Courier New, Courier, monospace;\">CREATE TABLE DOCUMENTOS (<br />  CODIGO VARCHAR(10) CHARACTER SET UTF8 COLLATE UNICODE<br />);<br /><br />INSERT INTO DOCUMENTOS VALUES ('A1');</span><div><span style=\"font-family: Courier New, Courier, monospace;\">INSERT INTO DOCUMENTOS VALUES ('A2');<br />INSERT INTO DOCUMENTOS VALUES ('A10');<br />INSERT INTO DOCUMENTOS VALUES ('A11');<br />INSERT INTO DOCUMENTOS VALUES ('A100');<br />INSERT INTO DOCUMENTOS VALUES ('B1');<br />INSERT INTO DOCUMENTOS VALUES ('B10');<br /><br />-- Resultado: A1, A10, A100, A11, A2, B1, B10<br />SELECT CODIGO FROM DOCUMENTOS ORDER BY CODIGO;</span><br /><br /><br /> O Firebird 2.5 permite que collates sejam configuráveis, e uma das opções do collate UNICODE permite que números sejam ordenados por ordem numérica. A <b>listagem 4</b> mostra a criação do collate UNICODE_NUM com o uso da opção NUMERIC-SORT e a ordenação usando este collate.</div><div><br /><b>Listagem 4</b>. Ordenação usando a opção NUMERIC-SORT do collate UNICODE.<br /><div><br /><span style=\"font-family: Courier New, Courier, monospace;\">CREATE COLLATION UNICODE_NUM FOR UTF8 FROM UNICODE 'NUMERIC-SORT=1';<br /><br />CREATE TABLE DOCUMENTOS2 (<br />  CODIGO VARCHAR(10) CHARACTER SET UTF8 COLLATE UNICODE_NUM<br />);<br /><br />INSERT INTO DOCUMENTOS2 SELECT * FROM DOCUMENTOS;<br /><br />-- Resultado: A1, A2, A10, A11, A100, B1, B10<br />SELECT CODIGO FROM DOCUMENTOS2 ORDER BY CODIGO;</span><br /><br /><br /> Outra novidade da versão 2.5 é o collate UNICODE_CI_AI (para o character set UTF8), variação do collate UNICODE pré-configurado para desconsiderar diferenças de acentos e maiúsculas/minúsculas. O collate UNICODE_CI_AI funciona de maneira similar ao WIN_PTBR e PT_BR, mas aceita o conjunto completo de caracteres Unicode.</div></div></div></p>\n","layout":"post","title":"Artigo \"Novidades do Firebird 2.5\": Character Sets e Collates","date":"2014-01-05T21:00:00.000-02:00","author":"Adriano dos Santos Fernandes","tags":["artigo","firebird"],"modified_time":"2014-01-05T21:00:03.506-02:00","blogger_id":"tag:blogger.com,1999:blog-3443854162607009076.post-6212076586177624881","blogger_orig_url":"http://asfernandes.blogspot.com/2014/01/artigo-novidades-do-firebird-25_5.html"}},"__N_SSG":true}